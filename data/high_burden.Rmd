---
title: "Data for the high burden countries only"
output: html_notebook
---

AIM: TB data for just the high burden countries

```{r}
library(dplyr)
library(tidyverse)

setwd("~/Desktop/AFP/modV3/data")
high_burden <- big_data[big_data$country %in% c("Angola", "Bangladesh", "Brazil", "China", "Democratic People's Republic of Korea", "Democratic Republic of the Congo", "Ethiopia", "India", "Indonesia", "Kenya", "Mozambique", "Myanmar", "Nigeria", "Pakistan", "Philippines", "Russian Federation", "South Africa", "Thailand", "United Republic of Tanzania", "Viet Nam", "Cambodia", "Central African Republic", "Congo", "Lesotho", "Liberia", "Namibia", "Papua New Guinea", "Sierra Leone", "Zambia", "Zimbabwe"), ]
pop <- read_csv("pop_data.csv")

burden_yearly1 <- high_burden[order(high_burden$iso3), ] 
burden_yearly2 <- burden_yearly1[order(burden_yearly1$year), ]
burden_yearly2 <- burden_yearly2[, -c(5:10)] ##Removing columns for EPTB as no data available 
burden_yearly2 <- burden_yearly2[, -c(6,7,12,13,18:20)]
```

Filtering the population data 

```{r}
library(tidyr)
colnames(pop) <- c("Country", "iso3", "series", "series_code", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

pop$`2013` <- as.numeric(pop$`2013`)
pop$`2014` <- as.numeric(pop$`2014`)
pop$`2015` <- as.numeric(pop$`2015`)
pop$`2016` <- as.numeric(pop$`2016`)
pop$`2017` <- as.numeric(pop$`2017`)
pop$`2018` <- as.numeric(pop$`2018`)
pop$`2019` <- as.numeric(pop$`2019`)
pop$`2020` <- as.numeric(pop$`2020`)

#Pivoting data to create data frame that can be merged with the high burden data frame 

pivot <- pivot_longer(pop, c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020"), names_to = "Year")

pivot2 <- pivot_wider(pivot, id_cols = c("Country", "iso3", "Year"), names_from = "series", values_from = "value")

pivot3 <- pivot2[-c(241:264), -17]

#Ordering the data by year 
pivot3$Year <- as.numeric(pivot3$Year)

pop_order1 <- pivot3[order(pivot3$iso3), ]
pop_order2 <- pop_order1[order(pop_order1$Year), ]

colnames(pop_order2)[colnames(pop_order2) == "Year"] <- "year"
```

Creating data frame with world bank population data and the age and sex disaggregated TB notification data 

```{r}
tb_pop <- merge(burden_yearly2, pop_order2, by = c("iso3", "year"))

tb_pop <- tb_pop[, -14]
```

Creating additional columns for 5-14 years male and female 

```{r}
colnames(tb_pop) <- c("iso3", "year", "country", "g_whoregion", "newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "pop_f04", "pop_m04", "pop_014%", "pop_f014", "pop_m014", "pop_tot014", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_tot", "pop_male", "pop_female")

tb_pop$pop_m59 <- as.numeric(tb_pop$pop_m59)
tb_pop$pop_m1014 <- as.numeric(tb_pop$pop_m1014)
tb_pop$pop_f59 <- as.numeric(tb_pop$pop_f59)
tb_pop$pop_f1014 <- as.numeric(tb_pop$pop_f1014)
pop_new1 <- mutate(tb_pop, "pop_m514" = pop_m59 + pop_m1014, "pop_f514" = pop_f59 + pop_f1014)

pop_new2 <- pop_new1[, c(1:15, 20:23, 27, 28, 17, 18, 16, 19, 26, 25, 24)]
```

Expressing incidence per 100,000 in each age group 

```{r}
pop_new2$pop_f04 <- as.numeric(pop_new2$pop_f04)
pop_new2$pop_m04 <- as.numeric(pop_new2$pop_m04)
pop_new2$pop_f014 <- as.numeric(pop_new2$pop_f014)
pop_new2$pop_m014 <- as.numeric(pop_new2$pop_m014)
pop_new2$`pop_014%` <- as.numeric(pop_new2$`pop_014%`)
pop_new2$pop_tot014 <- as.numeric(pop_new2$pop_tot014)
pop_new2$pop_female <- as.numeric(pop_new2$pop_female)
pop_new2$pop_male <- as.numeric(pop_new2$pop_male)
pop_new2$pop_tot <- as.numeric(pop_new2$pop_tot)

pop_100k <- mutate(pop_new2, "tb_m04_100k" = newrel_m04/(pop_m04/100000), "tb_f04_100k" = newrel_f04/(pop_f04/100000), "tb_m514_100k" = newrel_m514/(pop_m514/100000), "tb_f514_100k" = newrel_f514/(pop_f514/100000))
```

Adding columns for total male, female and combined TB incidence for all ages 

```{r}
tot_pop_100k <- mutate(pop_100k, "newrel_mtot" = newrel_m014 + newrel_m15plus, "newrel_ftot" = newrel_f014 + newrel_f15plus, "newrel_TOT" = newrel_mtot + newrel_ftot)

tot_pop_100k <- tot_pop_100k[, c(1:13, 33:35, 29:32, 14:23, 25:28)]
tot_pop_100k2 <- mutate(tot_pop_100k, "tb_m_100k" = newrel_mtot/(pop_male/100000), "tb_f_100k" = newrel_ftot/(pop_female/100000), "tb_tot_100k" = newrel_TOT/(pop_tot/100000))

tb_100k <- tot_pop_100k2[, c(1:20, 35:37, 21:34)]

```

Adding column for percentage of TB notifications in children 0-4 and 0-14 as percentage of total TB notifications 

```{r}
perc_tb_100k <- mutate(tb_100k, "perc_tb04" = ((newrel_m04 + newrel_f04)/newrel_TOT)*100, "perc_tb014" = ((newrel_m014 + newrel_f014)/newrel_TOT)*100)

```

Adding column for percentage of TB notifications in children 0-4 as percentage of TB notifications in children 0-14 

```{r}
perc_tb_final <- mutate(perc_tb_100k, "perc_youngkids" = 100 * ((newrel_m04 + newrel_f04)/(newrel_m014 + newrel_f014)))
```

Exporting the file as CSV 

```{r}
write.csv(perc_tb_final, file = "tb_cleaned_notifs.csv")
```

Creating graphs for the 30 high burden countries

```{r}
##Adding columns to the graph for non-sex disaggregated incidence in each age groups 

tb_graphplot <- mutate(perc_tb_final, "incid_04" = (newrel_m04 + newrel_f04)/((pop_m04 + pop_f04)/100000), "incid_514" = (newrel_m514 + newrel_f514)/((pop_m514 + newrel_f514)/100000), "incid_014" = (newrel_f014 + newrel_m014)/(pop_tot014/100000))

countries_04 <- ggplot(tb_graphplot, aes(x = year, y = incid_04, colour = country)) + 
  geom_point(size = 2) + geom_smooth() + xlab("year") + ylab("notifications in 0-4 yrs per 100k") + labs(title = "Notifications in children aged 0-4 years per 100k population in that age group")

countries_514 <- ggplot(tb_graphplot, aes(x = year, y = incid_514, colour = country)) + 
  geom_point(size = 2) + geom_smooth() + xlab("year") + ylab("notifications in 5-14 yrs per 100k") + labs(title = "Notifications in children aged 5-14 years per 100k population in that age group")

countries_014 <- ggplot(tb_graphplot, aes(x = year, y = incid_014, colour = country)) + 
  geom_point(size = 2) + geom_smooth() + xlab("year") + ylab("notifications in 0-14 yrs per 100k") + labs(title = "Notifications in children aged 0-14 years per 100k population in that age group")


```





Creating data frame with WHO regional data - Africa 


```{r}
omitsum <- function(x){ 
        sum(na.omit(x))}

africa_2013 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


africa_2014 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2015 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2016 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2017 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2018 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2019 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_2020 <- perc_tb_final %>% filter(g_whoregion == "AFR")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

africa_final <- cbind(africa_2013, africa_2014$., africa_2015$., africa_2016$., africa_2017$., africa_2018$., africa_2019$., africa_2020$.)

colnames(africa_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_africa <- as.data.frame(t(africa_final))

year_vector <- c(2013:2020)
trans_africa$year <- year_vector 
afr <- trans_africa[, c(27, 1:26)]

```

Data frame for south-east asia (SEA)

```{r}
sea_2013 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


sea_2014 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2015 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2016 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2017 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2018 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2019 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_2020 <- perc_tb_final %>% filter(g_whoregion == "SEA")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

sea_final <- cbind(sea_2013, sea_2014$., sea_2015$., sea_2016$., sea_2017$., sea_2018$., sea_2019$., sea_2020$.)

colnames(sea_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_sea <- as.data.frame(t(sea_final))

trans_sea$year <- year_vector 
sea <- trans_sea[, c(27, 1:26)]

```

Adding americas 

```{r}
amr_2013 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


amr_2014 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2015 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2016 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2017 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2018 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2019 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_2020 <- perc_tb_final %>% filter(g_whoregion == "AMR")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

amr_final <- cbind(amr_2013, amr_2014$., amr_2015$., amr_2016$., amr_2017$., amr_2018$., amr_2019$., amr_2020$.)

colnames(amr_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_amr <- as.data.frame(t(amr_final))

trans_amr$year <- year_vector 
amr <- trans_amr[, c(27, 1:26)]
```

Adding wpr zone

```{r}
wpr_2013 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


wpr_2014 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2015 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2016 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2017 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2018 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2019 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_2020 <- perc_tb_final %>% filter(g_whoregion == "WPR")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

wpr_final <- cbind(wpr_2013, wpr_2014$., wpr_2015$., wpr_2016$., wpr_2017$., wpr_2018$., wpr_2019$., wpr_2020$.)

colnames(wpr_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_wpr <- as.data.frame(t(wpr_final))

trans_wpr$year <- year_vector 
wpr <- trans_wpr[, c(27, 1:26)]
```

Adding EMR 

```{r}
emr_2013 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


emr_2014 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2015 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2016 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2017 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2018 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2019 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_2020 <- perc_tb_final %>% filter(g_whoregion == "EMR")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

emr_final <- cbind(emr_2013, emr_2014$., emr_2015$., emr_2016$., emr_2017$., emr_2018$., emr_2019$., emr_2020$.)

colnames(emr_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_emr <- as.data.frame(t(emr_final))

trans_emr$year <- year_vector 
emr <- trans_emr[, c(27, 1:26)]
```

Adding europe

```{r}
eur_2013 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2013) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame() 


eur_2014 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2014) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2015 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2015) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2016 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2016) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2017 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2017) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2018 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2018) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2019 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2019) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_2020 <- perc_tb_final %>% filter(g_whoregion == "EUR")  %>% filter(year == 2020) %>% select(c("newrel_m04", "newrel_m514", "newrel_m014", "newrel_m15plus", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f15plus", "newrel_hivpos", "newrel_mtot", "newrel_ftot", "newrel_TOT", "pop_f04", "pop_m04", "pop_f59", "pop_m59", "pop_f1014", "pop_m1014", "pop_m514", "pop_f514", "pop_f014", "pop_m014", "pop_tot014", "pop_female", "pop_male", "pop_tot")) %>% apply(MARGIN = 2, FUN = omitsum) %>% as.data.frame()

eur_final <- cbind(eur_2013, eur_2014$., eur_2015$., eur_2016$., eur_2017$., eur_2018$., eur_2019$., eur_2020$.)

colnames(eur_final) <- c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")

trans_eur <- as.data.frame(t(eur_final))

trans_eur$year <- year_vector 
eur <- trans_eur[, c(27, 1:26)]
```

creating derived columns for incidence per 100k 

```{r}
incid_100k <- function(df){
        mutate(df, "tb_m04_100k" = newrel_m04/(pop_m04/100000), "tb_f04_100k" = newrel_f04/(pop_f04/100000), "tb_m514_100k" = newrel_m514/(pop_m514/100000), "tb_f514_100k" = newrel_f514/(pop_f514/100000), "tb_m_100k" = newrel_mtot/(pop_male/100000), "tb_f_100k" = newrel_ftot/(pop_female/100000), "tb_tot_100k" = newrel_TOT/(pop_tot/100000))}

incid_afr <- incid_100k(afr)
incid_sea <- incid_100k(sea)
incid_amr <- incid_100k(amr)
incid_wpr <- incid_100k(wpr)
incid_emr <- incid_100k(emr)
incid_eur <- incid_100k(eur)
```

Creating combined data frame for WHO-regional data to allow creation of graphs

```{r}
region <- "AFR"
AFR1 <- cbind(incid_africa, region)
AFR1 <- AFR1[, c(35, 1:34)]

region <- "SEA"
SEA1 <- cbind(incid_sea, region)
SEA1 <- SEA1[, c(35, 1:34)]

region <- "AMR"
AMR1 <- cbind(incid_amr, region)
AMR1 <- AMR1[, c(35, 1:34)]

region <- "WPR"
WPR1 <- cbind(incid_wpr, region)
WPR1 <- WPR1[, c(35, 1:34)]

region <- "EMR"
EMR1 <- cbind(incid_emr, region)
EMR1 <- EMR1[, c(35, 1:34)]

region <- "EUR"
EUR1 <- cbind(incid_eur, region)
EUR1 <- EUR1[, c(35, 1:34)]

region_combo <- rbind(AFR1, SEA1, AMR1, WPR1, EMR1, EUR1)

```


Adding columns for derived data (e.g. notifications in children < 5 as percentage of notifications in all children)

```{r}
region_perc <- mutate(region_combo, "perc_tb_04" = 100 * ((newrel_m04 + newrel_f04)/newrel_TOT),
                      "perc_tb_014" = 100 * ((newrel_m014 + newrel_f014)/newrel_TOT),
                      "perc_youngkids" = 100 * ((newrel_m04 + newrel_f04)/(newrel_m014 + newrel_f014)))

```

Plotting the regional data for percentage of cases in 0-4, 0-14 and 0-4 as a percentage of 0-14 

```{r}
plot_perc_04 <- ggplot(region_perc, aes(x = year, y = perc_tb_04, colour = region)) + 
        geom_point(size = 2) + 
        geom_smooth() + xlab("year") + ylab("notifications in 0-4 as % of total") + labs(title = "Notifications in 0-4 as % of total by continent")

plot_perc_014 <- ggplot(region_perc, aes(x = year, y = perc_tb_014, colour = region)) + 
        geom_point(size = 2) + 
        geom_smooth() + xlab("year") + ylab("notifications in 0-14 as % of total") + labs(title = "Notifications in 0-14 as % of total by continent")

plot_perc_kids <- ggplot(region_perc, aes(x = year, y = perc_youngkids, colour = region)) + 
        geom_point(size = 2) + 
        geom_smooth() + xlab("year") + ylab("notifications in 0-4 as % of notifs in 0-14 yrs") + labs(title = "Notifications in 0-4 as % of notifs in 0-14 yrs by continent")

```

Plotting graphs looking at the changes in reporting of cases in each continent 

```{r}
region_tot <- mutate(region_perc, "newrel_tot04" = newrel_m04 + newrel_f04, "newrel_tot514" = newrel_m514 + newrel_f514, "newrel_tot014" = newrel_m014 + newrel_f014)

region_tot <- region_tot[, c(1:11, 39:41, 12:38)]

africa_only <- filter(region_tot, region == "AFR")

afr_notif <- ggplot(africa_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "africa")

sea_only <- filter(region_tot, region == "SEA")

sea_notif <- ggplot(sea_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "South-East Asia")

amr_only <- filter(region_tot, region == "AMR") 

amr_notif <- ggplot(amr_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "Americas")

wpr_only <- filter(region_tot, region == "WPR")

wpr_notif <- ggplot(wpr_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "Western-Pacific")

emr_only <- filter(region_tot, region == "EMR")

emr_notif <- ggplot(emr_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "Eastern Mediterranean")

eur_only <- filter(region_tot, region == "EUR")

eur_notif <- ggplot(eur_only, aes(year)) +
        geom_smooth(aes(y = newrel_tot04), colour = "pink") +
        geom_smooth(aes(y = newrel_tot514), colour = "red") + 
        xlab("year") + ylab("notifications") + labs(title = "Europe")

  
```

Plotting incidence data over time for each age group - separated by WHO region 

```{r}
##Including columns for incidence of TB for 0-4, 5-14 and 0-14 that is NOT sex disaggregated 

incid_new <- mutate(region_tot, "incid_04" = (newrel_m04 + newrel_f04)/((pop_m04 + pop_f04)/100000), "incid_514" = (newrel_m514 + newrel_f514)/((pop_m514 + newrel_f514)/100000), "incid_014" = (newrel_tot014)/(pop_tot014/100000))

plot_incid04 <- ggplot(incid_new, aes(x = year, y = incid_04, colour = region)) + 
  geom_point(size = 2) + 
  geom_smooth() + xlab("year") + ylab("notifs per 100k") + labs(title = "notifications per 100,000 children aged 0-4 yrs")

plot_incid514 <- ggplot(incid_new, aes(x = year, y = incid_514, colour = region)) + 
  geom_point(size = 2) +
  geom_smooth() + xlab("year") + ylab("notifications in 5-14 as % of total") + labs(title = "Notifications in 5-14 as % of total by WHO region")

plot_incid014 <- ggplot(incid_new, aes(x = year, y = incid_014, colour = region)) + 
  geom_point(size = 2) + 
  geom_smooth() + xlab("year") + ylab("notifications in 0-14 as % of total") + labs(title = "Notifications in 0-14 as % of total by WHO region")

plot_perc_04 <- ggplot(region_perc, aes(x = year, y = perc_tb_04, colour = region)) + 
        geom_point(size = 2) + 
        geom_smooth() + xlab("year") + ylab("notifications in 0-4 as % of total") + labs(title = "Notifications in 0-4 as % of total by continent")
```

Creating sex disaggregated stacked bar charts for children aged 0-4 years for each continent across the years 

```{r}
afr_sex04 <- incid_new %>% filter(region == "AFR") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,25000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for ages 0-4 years in AFR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

sea_sex04 <- incid_new %>% filter(region == "SEA") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,60000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for ages 0-4 years in SEA")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

amr_sex04 <- incid_new %>% filter(region == "AMR") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,1000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for ages 0-4 years in AMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

wpr_sex04 <- incid_new %>% filter(region == "WPR") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,25000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 0-4 years in WPR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

emr_sex04 <- incid_new %>% filter(region == "EMR") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,25000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 0-4 years in EMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

eur_sex04 <- incid_new %>% filter(region == "EUR") %>% select(newrel_m04, newrel_f04) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,1000), xlab = "year", ylab = "notifications") +
  title("Sex disaggregated notifications for ages 0-4 years in EUR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))
```
Creating sex disaggregated side-by-side bar charts for children aged 5-14 years 

```{r}
afr_sex514 <- incid_new %>% filter(region == "AFR") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,40000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in AFR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

sea_sex514 <- incid_new %>% filter(region == "SEA") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,100000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in SEA")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

amr_sex514 <- incid_new %>% filter(region == "AMR") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,1000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in AMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

wpr_sex514 <- incid_new %>% filter(region == "WPR") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,25000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in WPR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

emr_sex514 <- incid_new %>% filter(region == "EMR") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,25000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in EMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

eur_sex514 <- incid_new %>% filter(region == "EUR") %>% select(newrel_m514, newrel_f514) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,2000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 5-14 years in EUR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))
```
Creating sex disaggregated bar charts for cases above the age of 15 years 

```{r}
afr_sex_15plus <- incid_new %>% filter(region == "AFR") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,1000000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for 15plus years in AFR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

sea_sex_15plus <- incid_new %>% filter(region == "SEA") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,3000000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for 15plus years in SEA")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

amr_sex_15plus <- incid_new %>% filter(region == "AMR") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,100000), xlab = "year", ylab = "notifications") + title("Sex disaggregated notifications for 15plus years in AMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

wpr_sex_15plus <- incid_new %>% filter(region == "WPR") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,1000000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for 15plus years in WPR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

emr_sex_15plus <- incid_new %>% filter(region == "EMR") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,500000), xlab = "year", ylab = "notifications") + 
  title("Sex disaggregated notifications for ages 15plus years in EMR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))

eur_sex_15plus <- incid_new %>% filter(region == "EUR") %>% select(newrel_m15plus, newrel_f15plus) %>% 
  t() %>% barplot(col = c("skyblue", "seagreen1"), beside = TRUE, ylim = c(0,100000), xlab = "year", ylab = "notifications") +
  title("Sex disaggregated notifications for 15plus years in EUR")

legend("topright", legend = c("male", "female"), fill = c("skyblue", "seagreen1"))
```

